--[[
  黑洞中心脚本优化版
  功能：加载外部脚本、反挂机机制、Orion UI库界面
  优化点：
  1. 模块化结构
  2. 错误处理
  3. 代码注释
  4. 用户体验优化
--]]

-- 安全加载函数（带错误处理）
local function safeLoad(url)
    local success, result = pcall(function()
        return loadstring(game:HttpGet(url))()
    end)
    if not success then
        warn("加载失败: " .. url)
        game:GetService("StarterGui"):SetCore("SendNotification", {
            Title = "加载错误",
            Text = "无法加载资源: " .. url,
            Duration = 5
        })
    end
    return result
end

-- 反挂机系统
local function setupAntiAFK()
    local vu = game:GetService("VirtualUser")
    game:GetService("Players").LocalPlayer.Idled:Connect(function()
        vu:Button2Down(Vector2.new(0, 0), workspace.CurrentCamera.CFrame)
        task.wait(1)
        vu:Button2Up(Vector2.new(0, 0), workspace.CurrentCamera.CFrame)
    end)
    print("反挂机系统已开启")
end

-- 主界面通知
local function showNotifications()
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "脚本启动",
        Text = "请耐心等待加载",
        Duration = 4
    })
    
    task.wait(2)
    
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "系统状态",
        Text = "正在加载（反挂机已开启）",
        Duration = 5
    })
end

-- 主执行函数
local function main()
    -- 加载主脚本
    safeLoad("https://pastebin.com/raw/9fFu43FF")
    
    -- 显示初始通知
    showNotifications()
    
    -- 启动反挂机
    setupAntiAFK()
    
    -- 加载Orion UI库
    local OrionLib = safeLoad('https://pastebin.com/raw/ZGu8URpn')
    if not OrionLib then return end
    
    -- 创建主窗口
    local Window = OrionLib:MakeWindow({
        Name = "黑洞中心(BS)",
        HidePremium = false,
        SaveConfig = true,
        IntroText = "黑洞中心启动",
        ConfigFolder = "黑洞中心"
    })
    
    -- 信息介绍标签页
    local InfoTab = Window:MakeTab({
        Name = "公告",
        Icon = "rbxassetid://7734068321",
        PremiumOnly = false
    })
    
    InfoTab:AddParagraph("❤️ BS脚本 ❤️", "本脚本主要更新通用和黑洞类功能")
    InfoTab:AddParagraph("作者信息", "游戏名: 老大二世\nQQ: 1545959422\n副作者QQ: 1710433791")
    InfoTab:AddParagraph("更新状态", "原作者已停止更新\n现作者QQ: 2770967217")
    InfoTab:AddParagraph("交流群", "Q群: 813485162")
    
    -- 系统设置标签页
    local SettingsTab = Window:MakeTab({
        Name = "系统设置",
        Icon = "rbxassetid://7734068321",
        PremiumOnly = false
    })
    
    -- 用户信息展示
    local player = game.Players.LocalPlayer
    SettingsTab:AddParagraph("用户名", player.Name)
    SettingsTab:AddParagraph("注入器", identifyexecutor() or "未知")
    SettingsTab:AddParagraph("服务器ID", tostring(game.GameId))
    
    -- 功能按钮
    SettingsTab:AddButton({
        Name = "开启玩家进出提示",
        Callback = function()
            safeLoad("https://raw.githubusercontent.com/boyscp/scriscriptsc/main/bbn.lua")
            OrionLib:MakeNotification({
                Name = "提示系统已开启",
                Content = "玩家进出通知功能已激活",
                Time = 3
            })
        end
    })
    
    -- 跳跃高度设置
    SettingsTab:AddTextbox({
        Name = "设置跳跃高度",
        Default = "50",
        TextDisappear = true,
        Callback = function(Value)
            local num = tonumber(Value)
            if num and player.Character and player.Character:FindFirstChild("Humanoid") then
                player.Character.Humanoid.JumpPower = num
                OrionLib:MakeNotification({
                    Name = "设置成功",
                    Content = "跳跃高度已设置为: " .. num,
                    Time = 3
                })
            else
                OrionLib:MakeNotification({
                    Name = "设置失败",
                    Content = "请输入有效数字或确保角色存在",
                    Time = 3
                })
            end
        end
    })
    
    -- 初始化UI
    OrionLib:Init()
end

-- 错误保护的主执行
local success, err = pcall(main)
if not success then
    warn("脚本初始化失败: " .. err)
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "致命错误",
        Text = "脚本启动失败: " .. err,
        Duration = 10
    })
end
